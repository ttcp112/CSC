/** JsStore.js - v1.1.4 - 07/09/2017
 * https://github.com/ujjwalguptaofficial/JsStore
 * Copyright (c) 2017 @Ujjwal Gupta; Licensed MIT */
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),JsStore;!function(e){!function(e){e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.BadDataType="bad_data_type",e.NextJoinNotExist="next_join_not_exist",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist"}(e.ErrorType||(e.ErrorType={}));!function(e){e.First="f",e.Last="l",e.Any="a"}(e.Occurence||(e.Occurence={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started"}(e.ConnectionStatus||(e.ConnectionStatus={}))}(JsStore||(JsStore={}));var JsStore;!function(e){e.EnableLog=!1,e.throwError=function(e){throw e}}(JsStore||(JsStore={}));var JsStore;!function(e){var t=function(){function t(){}return t.getError=function(t,n){var r={Name:t,Message:""};switch(t){case e.ErrorType.NotArray:r.Message="Supplied value is not an array";break;case e.ErrorType.UndefinedColumn:r.Message="Column is undefined in Where";break;case e.ErrorType.UndefinedValue:r.Message="Value is undefined in Where";break;case e.ErrorType.UndefinedColumnName:r.Message="Column name is undefined";break;case e.ErrorType.UndefinedColumnValue:r.Message="Column value is undefined";break;case e.ErrorType.NoValueSupplied:r.Message="No value supplied";break;case e.ErrorType.InvalidOp:r.Message="Invalid Op Value '"+n.Op+"'";break;case e.ErrorType.ColumnNotExist:r.Message="Column '"+n.ColumnName+"' does not exist";break;case e.ErrorType.NullValue:r.Message="Null value is not allowed for column '"+n.ColumnName+"'";break;case e.ErrorType.BadDataType:r.Message="Supplied value for column '"+n.ColumnName+"' does not have valid type";break;case e.ErrorType.NextJoinNotExist:r.Message="Next join details not supplied";break;case e.ErrorType.TableNotExist:r.Message="Table '"+n.TableName+"' does not exist";break;case e.ErrorType.DbNotExist:r.Message="Database '"+n.DbName+"' does not exist";break;default:console.error("the error type is not defined")}return r},t.convertObjectintoLowerCase=function(e){for(var t=Object.keys(e),n=t.length;n--;){var r=t[n];e[r.toLowerCase()]=e[r],delete e[r]}},t.setDbType=function(){self.indexedDB=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,indexedDB?(self.IDBTransaction=self.IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange):e.throwError("Your browser doesnot support IndexedDb")},t}();e.Utils=t}(JsStore||(JsStore={}));var JsStore;!function(e){e.isDbExist=function(t,n){"string"==typeof t?e.getDbVersion(t,function(e){n(Boolean(e))}):e.getDbVersion(t.DbName,function(e){n(t.Table.Version<=e)})},e.getDbVersion=function(e,t){KeyStore.get("JsStore_"+e+"_Db_Version",function(e){t(Number(e))})},e.getDbSchema=function(e,t){t&&KeyStore.get("JsStore_"+e+"_Schema",function(e){t(e)})},e.isNull=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0==e.length;case"number":return isNaN(e)}return!1},e.enableLog=function(){e.EnableLog=!0},e.disableLog=function(){e.EnableLog=!1}}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var n=function(){return function(t,n){null!=t.Name?this.Name=t.Name:e.throwError("Column Name is not defined for table:"+n),this.AutoIncrement=null!=t.AutoIncrement&&t.AutoIncrement,this.PrimaryKey=null!=t.PrimaryKey&&t.PrimaryKey,this.Unique=null!=t.Unique&&t.Unique,this.NotNull=null!=t.NotNull&&t.NotNull,this.DataType=null!=t.DataType?t.DataType:"",this.Default=t.Default}}();t.Column=n}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var n=function(){function n(e,n){this.Name="",this.Columns=[],this.RequireDelete=!1,this.RequireCreation=!1,this.PrimaryKey="",this.Name=e.Name,this.Version=void 0==e.Version?1:e.Version;var r=this;e.Columns.forEach(function(n){r.Columns.push(new t.Column(n,e.Name))}),this.setRequireDelete(n),this.setDbVersion(n),this.setPrimaryKey(n)}return n.prototype.setPrimaryKey=function(e){var t=this;this.Columns.forEach(function(e){e.PrimaryKey&&(t.PrimaryKey=e.Name)})},n.prototype.setRequireDelete=function(e){var t=this;KeyStore.get("JsStore_"+e+"_"+this.Name+"_Version",function(e){null==e?t.RequireCreation=!0:e!=t.Version&&(t.RequireDelete=!0)})},n.prototype.setDbVersion=function(t){var n=this;e.DbVersion=e.DbVersion&&e.DbVersion>n.Version?e.DbVersion:n.Version,KeyStore.set("JsStore_"+t+"_Db_Version",e.DbVersion).set("JsStore_"+t+"_"+n.Name+"_Version",e.DbVersion),n.Version=e.DbVersion},n}();t.Table=n}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){var t=function(){return function(t){this.Tables=[];var n=this;this.Name=t.Name,t.Tables.forEach(function(t){n.Tables.push(new e.Table(t,n.Name))})}}();e.DataBase=t}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var n=function(){function n(){this.ErrorOccured=!1,this.ErrorCount=0,this.RowAffected=0,this.onErrorOccured=function(t,n){if(void 0===n&&(n=!1),1==++this.ErrorCount&&null!=this.OnError){if(n)this.OnError(t);else{var r={Name:t.target.error.name,Message:t.target.error.message};this.OnError(r)}e.EnableLog&&console.error(r)}},this.onTransactionTimeout=function(e){console.log("transaction timed out")},this.onExceptionOccured=function(t,n){switch(t.name){case"NotFoundError":var r=e.Utils.getError(e.ErrorType.TableNotExist,n);e.throwError(r);default:console.error(t)}},this.getTable=function(e){var n;return t.ActiveDataBase.Tables.every(function(t){return t.Name!=e||(n=t,!1)}),n},this.getKeyRange=function(e,t){var n;switch(t){case"-":n=IDBKeyRange.bound(e.Low,e.High,!1,!1);break;case">":n=IDBKeyRange.lowerBound(e,!0);break;case">=":n=IDBKeyRange.lowerBound(e);break;case"<":n=IDBKeyRange.upperBound(e,!0);break;case"<=":n=IDBKeyRange.upperBound(e);break;default:n=IDBKeyRange.only(e)}return n}}return n.prototype.checkForWhereConditionMatch=function(t){var n=this.Query.Where,r=!0;for(var o in n){var s=n[o];if(!r)break;var u=t[o];if("string"==typeof s&&s!=u)r=!1;else for(var i in s){if(!r)break;switch(i){case"In":!function(e,t){for(var o=n[e].In,s=0,u=o.length;s<u;s++){if(o[s]==t){r=!0;break}r=!1}}(o,t[o]);break;case"Like":!function(t,o){var s,u,i,c=n[t].Like.split("%");switch(c[1]?(u=c[1],s=c.length>2?e.Occurence.Any:e.Occurence.Last):(u=c[0],s=e.Occurence.First),o=o.toLowerCase(),i=o.indexOf(u.toLowerCase()),s){case e.Occurence.Any:i<0&&(r=!1);break;case e.Occurence.First:(i>0||i<0)&&(r=!1);break;default:i(u)<o.length-1&&(r=!1)}}(o,t[o]);break;case"-":case">":case"<":case">=":case"<=":!function(e,t,o){var s=n[e][o];switch(o){case">":s<=t&&(r=!1);break;case"<":s>=t&&(r=!1);break;case"<=":t>s&&(r=!1);break;case">=":t<s&&(r=!1);break;case"-":(t<s.Low||t>s.High)&&(r=!1)}}(o,t[o],i)}}}return r},n}();t.Base=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var n=function(){return function(n,r,o){var s=indexedDB.open(t.ActiveDataBase.Name,n);s.onerror=function(e){null!=o&&o(e.target.error)},s.onsuccess=function(n){t.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=s.result,t.DbConnection.onclose=function(){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection Closed"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(e){t.Status.LastError="Error occured in connection :"+e.target.result},t.DbConnection.onabort=function(n){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection aborted"},null!=r&&r(),KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_Schema",t.ActiveDataBase)},s.onupgradeneeded=function(e){var n=e.target.result;t.ActiveDataBase.Tables.forEach(function(e){e.RequireDelete?(n.objectStoreNames.contains(e.Name)&&n.deleteObjectStore(e.Name),u(n,e)):e.RequireCreation&&u(n,e)})};var u=function(e,n){try{if(n.PrimaryKey.length>0)r=e.createObjectStore(n.Name,{keyPath:n.PrimaryKey}),n.Columns.forEach(function(e){e.PrimaryKey?r.createIndex(e.Name,e.Name,{unique:!0}):r.createIndex(e.Name,e.Name,{unique:e.Unique}),e.AutoIncrement&&KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+n.Name+"_"+e.Name+"_Value",0)});else{var r=e.createObjectStore(n.Name,{autoIncrement:!0});n.Columns.forEach(function(e){r.createIndex(e.Name,e.Name,{unique:e.Unique}),e.AutoIncrement&&KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+n.Name+"_"+e.Name+"_Value",0)})}KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+n.Name+"_Version",n.Version)}catch(e){console.error(e)}}}}();t.CreateDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var n=function(){return function(n,r,o){var s=indexedDB.deleteDatabase(n);s.onblocked=function(){null!=o&&o("delete database is in progress")},s.onerror=function(e){null!=o&&o(event.target.error)},s.onsuccess=function(){t.Status.ConStatus=e.ConnectionStatus.Closed,KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_Db_Version"),t.ActiveDataBase.Tables.forEach(function(e){KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_"+e.Name+"_Version"),e.Columns.forEach(function(n){n.AutoIncrement&&KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_"+e.Name+"_"+n.Name+"_Value")})}),KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_Schema"),null!=r&&r()}}}();t.DropDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var n=function(n){function r(r,o,s){var u=n.call(this)||this;u.ValuesAffected=[],u.ValuesIndex=0,u.onTransactionCompleted=function(){null!=this.OnSuccess&&this.OnSuccess(this.Query.Return?this.ValuesAffected:this.RowAffected)},u.checkAndModifyValues=function(e){var t=this,n=function(r){r?t.checkAndModifyValue(r,function(){t.ErrorOccured?t.onErrorOccured(t.Error,!0):n(t.Query.Values[t.ValuesIndex++])}):e()};n(this.Query.Values[this.ValuesIndex++])},u.insertData=function(){var e=this,n=this.Query.Return,r=function(t){if(t){var o=e.ObjectStore.add(t);o.onerror=function(t){e.onErrorOccured(t)},o.onsuccess=function(o){n?e.ValuesAffected.push(t):++e.RowAffected,r(e.Query.Values[e.ValuesIndex++])}}};e.ValuesIndex=0,e.Transaction=t.DbConnection.transaction([e.Query.Into],"readwrite"),e.ObjectStore=e.Transaction.objectStore(e.Query.Into),e.Transaction.oncomplete=function(t){e.onTransactionCompleted()},r(this.Query.Values[e.ValuesIndex++])};try{u.Query=r,u.OnSuccess=o,u.OnError=s;var i=u;if(u.Table=u.getTable(r.Into),u.Table)u.Query.SkipExtraCheck?u.insertData():u.checkAndModifyValues(function(){i.insertData()});else{var c=e.Utils.getError(e.ErrorType.TableNotExist,{TableName:r.Into});e.throwError(c)}}catch(e){u.onExceptionOccured(e,{TableName:r.Into})}return u}return __extends(r,n),r.prototype.checkAndModifyValue=function(n,r){var o=this,s=this.Table.Name,u=0,i=function(c){if(c){var a=function(){c.NotNull&&e.isNull(n[c.Name])?(o.ErrorOccured=!0,o.Error=e.Utils.getError(e.ErrorType.NullValue,{ColumnName:c.Name})):c.DataType&&typeof n[c.Name]!=c.DataType&&(o.ErrorOccured=!0,o.Error=e.Utils.getError(e.ErrorType.BadDataType,{ColumnName:c.Name})),i(o.Table.Columns[u++])};o.ErrorOccured?r():c.AutoIncrement?KeyStore.get("JsStore_"+t.ActiveDataBase.Name+"_"+s+"_"+c.Name+"_Value",function(e){n[c.Name]=++e,KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+s+"_"+c.Name+"_Value",e),a()}):c.Default&&null==n[c.Name]?(n[c.Name]=c.Default,a()):a()}else r()};i(o.Table.Columns[u++])},r}(t.Base);t.Insert=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){var n=function(){return function(n,r,o){if(t.ActiveDataBase.Name.length>0){var s=indexedDB.open(t.ActiveDataBase.Name,n);s.onerror=function(e){null!=o&&o(e.target.error)},s.onsuccess=function(n){t.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=s.result,t.DbConnection.onclose=function(){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection Closed, trying to reconnect"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(e){t.Status.LastError="Error occured in connection :"+e.target.result},t.DbConnection.onabort=function(n){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection Aborted"},null!=r&&r()}}else e.throwError("Database name is not supplied.")}}();t.OpenDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this,u=s,i=e.DbConnection.transaction([n],"readwrite").objectStore(n).clear();return i.onsuccess=function(t){u.getTable(n).Columns.forEach(function(t){t.AutoIncrement&&KeyStore.remove("JsStore_"+e.ActiveDataBase.Name+"_"+n+"_"+t.Name+"_Value")}),null!=r&&r()},i.onerror=function(e){null!=o&&o()},s}return __extends(n,t),n}(e.Base);e.Clear=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){t.Status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""};var n=function(){return function(n){void 0===n&&(n=null),this.checkConnectionAndExecuteLogic=function(n){if(e.EnableLog&&console.log("checking connection and executing request:"+n.Name),"create_db"==n.Name||"open_db"==n.Name)this.executeLogic(n);else if(t.Status.ConStatus==e.ConnectionStatus.Connected)this.executeLogic(n);else if(t.Status.ConStatus==e.ConnectionStatus.NotStarted)r=this,setTimeout(function(){r.checkConnectionAndExecuteLogic(n)},50);else if(t.Status.ConStatus==e.ConnectionStatus.Closed){var r=this;this.openDb(t.ActiveDataBase.Name,function(){r.checkConnectionAndExecuteLogic(n)})}},this.returnResult=function(e){this.OnSuccess?this.OnSuccess(e):self.postMessage(e)},this.executeLogic=function(e){var t=this,n=function(e){t.returnResult({ReturnedValue:e})},r=function(e){t.returnResult({ErrorOccured:!0,ErrorDetails:e})};switch(e.Name){case"select":this.select(e.Query,n,r);break;case"insert":this.insert(e.Query,n,r);break;case"update":this.update(e.Query,n,r);break;case"delete":this.delete(e.Query,n,r);break;case"create_db":this.createDb(e.Query,n,r);break;case"clear":this.clear(e.Query,n,r);break;case"drop_db":this.dropDb(n,r);break;case"count":this.count(e.Query,n,r);break;case"open_db":this.openDb(e.Query,n,r)}},this.openDb=function(n,r,o){KeyStore.get("JsStore_"+n+"_Db_Version",function(s){if(null==s)throw e.Utils.getError(e.ErrorType.DbNotExist,{DbName:n});KeyStore.get("JsStore_"+n+"_Schema",function(e){t.ActiveDataBase=e,new t.OpenDb(s,r,o)})})},this.closeDb=function(){t.Status.ConStatus==e.ConnectionStatus.Connected&&t.DbConnection.close()},this.dropDb=function(e,n){new t.DropDb(t.ActiveDataBase.Name,e,n)},this.update=function(e,n,r){new t.Update.Instance(e,n,r)},this.insert=function(n,r,o){Array.isArray(n.Values)?new t.Insert(n,r,o):e.throwError("Value should be array :- supplied value is not array")},this.delete=function(e,n,r){new t.Delete.Instance(e,n,r)},this.select=function(e,n,r){"object"==typeof e.From?new t.Select.Join(e,n,r):new t.Select.Instance(e,n,r)},this.count=function(e,n,r){"object"==typeof e.From?(e.Count=!0,new t.Select.Join(e,n,r)):new t.Count.Instance(e,n,r)},this.createDb=function(n,r,o){KeyStore.get("JsStore_"+n.Name+"_Db_Version",function(s){e.DbVersion=s,t.ActiveDataBase=new e.Model.DataBase(n);var u=function(){setTimeout(function(){var n=t.ActiveDataBase.Tables[t.ActiveDataBase.Tables.length-1];KeyStore.get("JsStore_"+t.ActiveDataBase.Name+"_"+n.Name+"_Version",function(s){s==n.Version?new t.CreateDb(e.DbVersion,r,o):u()})},200)};u()})},this.clear=function(e,n,r){new t.Clear(e,n,r)},this.OnSuccess=n}}();t.Main=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Results=[],t.SendResultFlag=!0,t.Sorted=!1,t}return __extends(t,e),t}(e.Base);t.BaseSelect=n}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeWhereUndefinedLogic=function(){var t,n=this;if(this.Query.Order&&this.Query.Order.By)if(n.ObjectStore.indexNames.contains(this.Query.Order.By)){var r=this.Query.Order.Type&&"desc"==this.Query.Order.Type.toLowerCase()?"prev":"next";this.Sorted=!0,t=this.ObjectStore.index(n.Query.Order.By).openCursor(null,r)}else{var o=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:this.Query.Order.By});e.throwError(o)}else t=this.ObjectStore.openCursor();this.SkipRecord&&this.LimitRecord?function(){var e=!1;t.onsuccess=function(t){var r=t.target.result;r&&(e&&n.Results.length!=n.LimitRecord?(n.Results.push(r.value),r.continue()):(e=!0,r.advance(n.SkipRecord)))}}():this.SkipRecord?function(){var e=!1;t.onsuccess=function(t){var r=t.target.result;r&&(e?(n.Results.push(r.value),r.continue()):(e=!0,r.advance(n.SkipRecord)))}}():this.LimitRecord?t.onsuccess=function(e){var t=e.target.result;t&&n.Results.length!=n.LimitRecord&&(n.Results.push(t.value),t.continue())}:t.onsuccess=function(e){var t=e.target.result;t&&(n.Results.push(t.value),t.continue())},t.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)}},n}return __extends(n,t),n}(t.BaseSelect);t.NotWhere=n}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.CheckFlag=!1,n.filterOnOccurence=function(t){var n=!1,r=t[this.Column].toLowerCase();switch(this.CompSymbol){case e.Occurence.Any:r.indexOf(this.CompValue)>=0&&(n=!0);break;case e.Occurence.First:0==r.indexOf(this.CompValue)&&(n=!0);break;default:r.lastIndexOf(this.CompValue)==r.length-1&&(n=!0)}return n},n.executeSkipAndLimit=function(){var e=this.SkipRecord,t=this;this.CursorOpenRequest.onsuccess=function(n){var r=n.target.result,o=function(){0==e?t.Results.push(r.value):--e};t.Results.length!=t.LimitRecord&&r&&(!t.CheckFlag&&t.filterOnOccurence(r.value)?o():t.filterOnOccurence(r.value)&&t.checkForWhereConditionMatch(r.value)&&o(),r.continue())}},n.executeSkip=function(){var e=this.SkipRecord,t=this;this.CursorOpenRequest.onsuccess=function(n){var r=n.target.result,o=function(){0==e?t.Results.push(r.value):--e};r&&(!t.CheckFlag&&t.filterOnOccurence(r.value)?o():t.filterOnOccurence(r.value)&&t.checkForWhereConditionMatch(r.value)&&o(),r.continue())}},n.executeLimit=function(){var e=this;this.CursorOpenRequest.onsuccess=function(t){var n=t.target.result;e.Results.length!=e.LimitRecord&&n&&(!e.CheckFlag&&e.filterOnOccurence(n.value)?e.Results.push(n.value):e.filterOnOccurence(n.value)&&e.checkForWhereConditionMatch(n.value)&&e.Results.push(n.value),n.continue())}},n.executeSimple=function(){var e=this;this.CursorOpenRequest.onsuccess=function(t){var n=t.target.result;n&&(!e.CheckFlag&&e.filterOnOccurence(n.value)?e.Results.push(n.value):e.filterOnOccurence(n.value)&&e.checkForWhereConditionMatch(n.value)&&e.Results.push(n.value),n.continue())}},n.executeLikeLogic=function(e,t,n){var r=this;this.CompValue=t.toLowerCase(),this.CompSymbol=n,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)},this.SkipRecord&&this.LimitRecord?this.executeSkipAndLimit():this.SkipRecord?this.executeSkip():this.LimitRecord?this.executeLimit():this.executeSimple()},n}return __extends(n,t),n}(t.NotWhere);t.Like=n}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeRequest=function(e,t,n){var r,o=this;t=n?t[n]:t,r=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,n)),this.SkipRecord&&this.LimitRecord?function(){var e=!1;r.onsuccess=function(t){var n=t.target.result;n&&(e&&o.Results.length!=o.LimitRecord?(o.CheckFlag?o.checkForWhereConditionMatch(n.value)&&o.Results.push(n.value):o.Results.push(n.value),n.continue()):(e=!0,n.advance(o.SkipRecord)))}}():this.SkipRecord?function(){var e=!1;r.onsuccess=function(t){var n=t.target.result;n&&(e?(o.CheckFlag?o.checkForWhereConditionMatch(n.value)&&o.Results.push(n.value):o.Results.push(n.value),n.continue()):(e=!0,n.advance(o.SkipRecord)))}}():this.LimitRecord?r.onsuccess=function(e){var t=e.target.result;t&&o.Results.length!=o.LimitRecord&&(o.CheckFlag?o.checkForWhereConditionMatch(t.value)&&o.Results.push(t.value):o.Results.push(t.value),t.continue())}:r.onsuccess=function(e){var t=e.target.result;t&&(o.CheckFlag?o.checkForWhereConditionMatch(t.value)&&o.Results.push(t.value):o.Results.push(t.value),t.continue())},r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)}},n.executeWhereLogic=function(){for(var t in this.Query.Where){if(!this.ErrorOccured)if(this.ObjectStore.indexNames.contains(t)){var n=this.Query.Where[t];if("string"==typeof n)this.executeRequest(t,n);else if(this.CheckFlag=Object.keys(n).length>1||Object.keys(this.Query.Where).length>1,n.Like){var r=n.Like.split("%");r[1]?r.length>2?this.executeLikeLogic(t,r[1],e.Occurence.Any):this.executeLikeLogic(t,r[1],e.Occurence.Last):this.executeLikeLogic(t,r[0],e.Occurence.First)}else if(n.In)for(var o=0;o<n.In.length;o++)this.executeRequest(t,n.In[o]);else n["-"]?this.executeRequest(t,n,"-"):n[">"]?this.executeRequest(t,n,">"):n["<"]?this.executeRequest(t,n,"<"):n[">="]?this.executeRequest(t,n,">="):n["<="]?this.executeRequest(t,n,"<="):this.executeRequest(t,n)}else this.ErrorOccured=!0,this.Error=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:t}),e.throwError(this.Error);break}},n}return __extends(n,t),n}(t.Like);t.Where=n}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this;s.QueryStack=[],s.CurrentQueryStackIndex=0,s.onTransactionCompleted=function(e){null!=this.OnSuccess&&this.QueryStack.length==this.CurrentQueryStackIndex+1&&(this.Query.Count?this.OnSuccess(this.Results.length):(this.Query.Skip&&this.Query.Limit?(this.Results.splice(0,this.Query.Skip),this.Results.splice(this.Query.Limit-1,this.Results.length)):this.Query.Skip?this.Results.splice(0,this.Query.Skip):this.Query.Limit&&this.Results.splice(this.Query.Limit-1,this.Results.length),this.OnSuccess(this.Results)))},s.executeWhereJoinLogic=function(t,n){var r,o=this,s=[],u=0,i=(n.Column,o.Results),c=i.length;new e.Instance({From:n.Table,Where:n.Where,Order:n.Order},function(e){e.forEach(function(e,n){for(var o=0;o<c;o++)r=i[o][t.Table][t.Column],a(r,e,o)}),o.Results=s,o.QueryStack.length>o.CurrentQueryStackIndex+1?o.startExecutionJoinLogic():o.onTransactionCompleted(null)},function(e){o.onErrorOccured(e)});var a=function(e,t,r){if(s[u]={},e==t[n.Column]){s[u][n.Table]=t;for(c=0;c<o.CurrentQueryStackIndex;c++)s[u][o.QueryStack[c].Table]=i[r][o.QueryStack[c].Table];++u}else if("left"==n.JoinType){s[u]={},s[u][n.Table]=null;for(var c=0;c<o.CurrentQueryStackIndex;c++)s[u][o.QueryStack[c].Table]=i[r][o.QueryStack[c].Table];++u}}},s.executeRightJoin=function(t,n){var r=this,o=[],s=(n.Column,r.Results),u=s.length,i=0,c=function(){r.Results=o,r.QueryStack.length>r.CurrentQueryStackIndex+1?r.startExecutionJoinLogic():r.onTransactionCompleted(null)},a=function(e){var c=!1;e.forEach(function(e,a){for(i=0;i<u;i++)if(e[n.Column]==s[i][t.Table][t.Column]){c=!0;break}if(o[a]={},o[a][n.Table]=e,c){c=!1;for(l=0;l<r.CurrentQueryStackIndex;l++)o[a][r.QueryStack[l].Table]=s[i][r.QueryStack[l].Table]}else for(var l=0;l<r.CurrentQueryStackIndex;l++)o[a][r.QueryStack[l].Table]=null})};new e.Instance({From:n.Table,Where:n.Where,Order:n.Order},function(e){a(e),c()},function(e){r.ErrorOccured=!0,r.onErrorOccured(e)})},s.executeWhereUndefinedLogicForJoin=function(t,n){var r=this,o=[],s=0,u=(n.Column,r.Results),i=u.length,c=0,a={},l=function(){r.Results=o,r.QueryStack.length>r.CurrentQueryStackIndex+1?r.startExecutionJoinLogic():r.onTransactionCompleted(null)},h=function(e){if(e.length>0)e.forEach(function(e){o[s]={},o[s][n.Table]=e;for(var t=0;t<r.CurrentQueryStackIndex;t++)o[s][r.QueryStack[t].Table]=u[c][r.QueryStack[t].Table];++s});else if("left"==n.JoinType){o[s]={},o[s][n.Table]=null;for(var t=0;t<r.CurrentQueryStackIndex;t++)o[s][r.QueryStack[t].Table]=u[c][r.QueryStack[t].Table];++s}},f=function(){c<i?r.ErrorOccured||(a[n.Column]=u[c][t.Table][t.Column],new e.Instance({From:n.Table,Where:a,Order:n.Order},function(e){h(e),++c,f()},function(e){r.ErrorOccured=!0,r.onErrorOccured(e)})):l()};f()},s.OnSuccess=r,s.OnError=o,s.Query=n;var u=s,i=[],c=function(e){return e.hasOwnProperty("Table1")?(e.Table2.JoinType=void 0==e.Join?"inner":e.Join.toLowerCase(),u.QueryStack.push(e.Table2),u.QueryStack.length%2==0&&(u.QueryStack[u.QueryStack.length-1].NextJoin=e.NextJoin),i.push(e.Table2.Table),c(e.Table1)):(u.QueryStack.push(e),void i.push(e.Table))};return c(n.From),s.QueryStack.reverse(),s.ErrorOccured||new e.Instance({From:s.QueryStack[0].Table,Where:s.QueryStack[0].Where},function(e){var t=u.QueryStack[0].Table;e.forEach(function(e,n){u.Results[n]={},u.Results[n][t]=e}),u.startExecutionJoinLogic()},function(e){u.onErrorOccured(e)}),s}return __extends(n,t),n.prototype.startExecutionJoinLogic=function(){var e;this.CurrentQueryStackIndex>=1&&this.CurrentQueryStackIndex%2==1?(e={Table:this.QueryStack[this.CurrentQueryStackIndex].NextJoin.Table,Column:this.QueryStack[this.CurrentQueryStackIndex].NextJoin.Column},this.CurrentQueryStackIndex++):e=this.QueryStack[this.CurrentQueryStackIndex++];var t=this.QueryStack[this.CurrentQueryStackIndex];"right"==t.JoinType?this.executeRightJoin(e,t):t.Where?this.executeWhereJoinLogic(e,t):this.executeWhereUndefinedLogicForJoin(e,t)},n}(e.BaseSelect);e.Join=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var n=function(t){function n(n,r,o){var s=t.call(this)||this;s.onTransactionCompleted=function(){var e=this.Query.Order;if(e&&this.Results.length>0&&!this.Sorted&&e.By){e.Type=e.Type?e.Type.toLowerCase():"asc";var t=this,n=e.By;"string"==typeof this.Results[0][n]?"asc"==e.Type?t.Results.sort(function(e,t){return e[n].toLowerCase().localeCompare(t[n].toLowerCase())}):t.Results.sort(function(e,t){return t[n].toLowerCase().localeCompare(e[n].toLowerCase())}):"number"==typeof this.Results[0][n]&&("asc"==e.Type?t.Results.sort(function(e,t){return e[n]-t[n]}):t.Results.sort(function(e,t){return t[n]-e[n]})),this.OnSuccess&&this.OnSuccess(this.Results)}else this.SendResultFlag&&this.OnSuccess&&this.OnSuccess(this.Results)};var u=s;s.Query=n,s.OnSuccess=r,s.OnError=o,s.SkipRecord=s.Query.Skip,s.LimitRecord=s.Query.Limit;try{s.Transaction=e.DbConnection.transaction([n.From],"readonly"),s.Transaction.oncomplete=function(e){u.onTransactionCompleted()},s.Transaction.ontimeout=u.onTransactionCompleted,s.ObjectStore=s.Transaction.objectStore(n.From),void 0!=n.Where?s.executeWhereLogic():s.executeWhereUndefinedLogic()}catch(e){s.onExceptionOccured(e,{TableName:n.From})}return s}return __extends(n,t),n}(t.Where);t.Instance=n}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ResultCount=0,t.SendResultFlag=!0,t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);t.BaseCount=n}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){var e=this;if(this.ObjectStore.count){var t=this.ObjectStore.count();t.onsuccess=function(){e.ResultCount=t.result},t.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}}else{var n=this.ObjectStore.openCursor();n.onsuccess=function(t){var n=t.target.result;n&&(++e.ResultCount,n.continue())},n.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}}},t}return __extends(t,e),t}(e.BaseCount);e.NotWhere=t}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.filterOnOccurence=function(t){var n=!1,r=t[this.Column].toLowerCase();switch(this.CompSymbol){case e.Occurence.Any:r.indexOf(this.CompValue)>=0&&(n=!0);break;case e.Occurence.First:0==r.indexOf(this.CompValue)&&(n=!0);break;default:r.lastIndexOf(this.CompValue)==r.length-1&&(n=!0)}return n},n.executeLikeLogic=function(e,t,n){var r=this;this.CompValue=t.toLowerCase(),this.CompSymbol=n,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)},this.CursorOpenRequest.onsuccess=function(e){var t=e.target.result;t&&(r.filterOnOccurence(t.value)&&r.checkForWhereConditionMatch(t.value)&&++r.ResultCount,t.continue())}},n}return __extends(n,t),n}(t.NotWhere);t.Like=n}(t.Count||(t.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeRequest=function(e,t,n){var r,o=this;t=n?t[n]:t,(r=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,n))).onsuccess=function(e){var t=e.target.result;t&&(o.CheckFlag?o.checkForWhereConditionMatch(t.value)&&++o.ResultCount:++o.ResultCount,t.continue())},r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)}},n.executeWhereLogic=function(){for(var t in this.Query.Where){if(!this.ErrorOccured)if(this.ObjectStore.indexNames.contains(t)){var n=this.Query.Where[t];if("string"==typeof n)this.executeRequest(t,n);else if(this.CheckFlag=Object.keys(n).length>1||Object.keys(this.Query.Where).length>1,n.Like){var r=n.Like.split("%");r[1]?r.length>2?this.executeLikeLogic(t,r[1],e.Occurence.Any):this.executeLikeLogic(t,r[1],e.Occurence.Last):this.executeLikeLogic(t,r[0],e.Occurence.First)}else if(n.In)for(var o=0;o<n.In.length;o++)this.executeRequest(t,n.In[o]);else n["-"]?this.executeRequest(t,n,"-"):n[">"]?this.executeRequest(t,n,">"):n["<"]?this.executeRequest(t,n,"<"):n[">="]?this.executeRequest(t,n,">="):n["<="]?this.executeRequest(t,n,"<="):this.executeRequest(t,n)}else this.ErrorOccured=!0,this.Error=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:t}),e.throwError(this.Error);break}},n}return __extends(n,t),n}(t.Like);t.Where=n}(t.Count||(t.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var n=function(t){function n(n,r,o){var s=t.call(this)||this;s.onTransactionCompleted=function(){this.SendResultFlag&&null!=this.OnSuccess&&this.OnSuccess(this.ResultCount)};var u=s;s.Query=n,s.OnSuccess=r,s.OnError=o;try{s.Transaction=e.DbConnection.transaction([n.From],"readonly"),s.Transaction.oncomplete=function(e){u.onTransactionCompleted()},s.ObjectStore=s.Transaction.objectStore(n.From),void 0!=n.Where?s.executeWhereLogic():s.executeWhereUndefinedLogic()}catch(e){s.onExceptionOccured(e,{TableName:n.From})}return s}return __extends(n,t),n}(t.Where);t.Instance=n}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){(e.Update||(e.Update={})).updateValue=function(e,t){for(var n in e)if("object"!=typeof e[n])t[n]=e[n];else for(var r in e[n]){switch(r){case"+":t[n]+=e[n][r];break;case"-":t[n]-=e[n][r];break;case"*":t[n]*=e[n][r];break;case"/":t[n]/=e[n][r];break;default:t[n]=e[n]}break}return t};var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SendResultFlag=!0,t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);e.BaseUpdate=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.executeWhereUndefinedLogic=function(){var e=this,n=this.ObjectStore.openCursor();n.onsuccess=function(n){var r=n.target.result;r&&(r.update(t.updateValue(e.Query.Set,r.value)),++e.RowAffected,r.continue())},n.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}},n}return __extends(n,e),n}(e.BaseUpdate);t.NotWhere=n}(e.Update||(e.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(n){function r(){var r=null!==n&&n.apply(this,arguments)||this;return r.filterOnOccurence=function(t){var n=!1,r=t[this.Column].toLowerCase();switch(this.CompSymbol){case e.Occurence.Any:r.indexOf(this.CompValue)>=0&&(n=!0);break;case e.Occurence.First:0==r.indexOf(this.CompValue)&&(n=!0);break;default:r.lastIndexOf(this.CompValue)==r.length-1&&(n=!0)}return n},r.executeLikeLogic=function(e,n,r){var o=this;this.CompValue=n.toLowerCase(),this.CompSymbol=r,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)},this.CursorOpenRequest.onsuccess=function(e){var n=e.target.result,r=function(){n.update(t.updateValue(o.Query.Set,n.value)),++o.RowAffected};n&&(!o.CheckFlag&&o.filterOnOccurence(n.value)?r():o.filterOnOccurence(n.value)&&o.checkForWhereConditionMatch(n.value)&&r(),n.continue())}},r}return __extends(r,n),r}(t.NotWhere);t.Like=n}(t.Update||(t.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(n){function r(){var r=null!==n&&n.apply(this,arguments)||this;return r.executeRequest=function(e,n,r){var o,s=this;n=r?n[r]:n,(o=this.ObjectStore.index(e).openCursor(this.getKeyRange(n,r))).onsuccess=function(e){var n=e.target.result;if(n){var r=function(){n.update(t.updateValue(s.Query.Set,n.value)),++s.RowAffected};s.CheckFlag?s.checkForWhereConditionMatch(n.value)&&r():r(),n.continue()}},o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)}},r.executeWhereLogic=function(){for(var t in this.Query.Where){if(!this.ErrorOccured)if(this.ObjectStore.indexNames.contains(t)){var n=this.Query.Where[t];if("string"==typeof n)this.executeRequest(t,n);else if(this.CheckFlag=Object.keys(n).length>1||Object.keys(this.Query.Where).length>1,n.Like){var r=n.Like.split("%");r[1]?r.length>2?this.executeLikeLogic(t,r[1],e.Occurence.Any):this.executeLikeLogic(t,r[1],e.Occurence.Last):this.executeLikeLogic(t,r[0],e.Occurence.First)}else if(n.In)for(var o=0;o<n.In.length;o++)this.executeRequest(t,n.In[o]);else n["-"]?this.executeRequest(t,n,"-"):n[">"]?this.executeRequest(t,n,">"):n["<"]?this.executeRequest(t,n,"<"):n[">="]?this.executeRequest(t,n,">="):n["<="]?this.executeRequest(t,n,"<="):this.executeRequest(t,n)}else this.ErrorOccured=!0,this.Error=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:t}),e.throwError(this.Error);break}},r}return __extends(r,n),r}(t.Like);t.Where=n}(t.Update||(t.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(n){var r=function(n){function r(e,r,o){var s=n.call(this)||this;s.onTransactionCompleted=function(){null!=this.OnSuccess&&this.OnSuccess(this.RowAffected)};try{u=s;if(s.OnError=o,s.checkSchema(e.Set,e.In),s.ErrorOccured)s.onErrorOccured(s.Error,!0);else{s.Query=e,s.OnSuccess=r,s.Transaction=t.DbConnection.transaction([e.In],"readwrite"),s.ObjectStore=s.Transaction.objectStore(e.In);var u=s;s.Transaction.oncomplete=function(e){u.onTransactionCompleted()},s.Transaction.ontimeout=u.onTransactionTimeout,void 0==e.Where?s.executeWhereUndefinedLogic():s.executeWhereLogic()}}catch(t){s.onExceptionOccured(t,{TableName:e.In})}return s}return __extends(r,n),r.prototype.checkSchema=function(t,n){var r=this.getTable(n),o=this;if(!r)throw e.Utils.getError(e.ErrorType.TableNotExist,{TableName:n});r.Columns.every(function(n){if(o.ErrorOccured)return!1;if(n.Name in t){!function(t){n.NotNull&&e.isNull(t)&&(o.ErrorOccured=!0,o.Error=e.Utils.getError(e.ErrorType.NullValue,{ColumnName:n.Name})),n.DataType&&typeof t!=n.DataType&&(o.ErrorOccured=!0,o.Error=e.Utils.getError(e.ErrorType.BadDataType,{ColumnName:n.Name}))}(t[n.Name])}return!0})},r}(n.Where);n.Instance=r}(t.Update||(t.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SendResultFlag=!0,t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);t.BaseDelete=n}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){var e=this,t=this.ObjectStore.openCursor();t.onsuccess=function(t){var n=t.target.result;n&&(n.delete(),++e.RowAffected,n.continue())},t.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}},t}return __extends(t,e),t}(e.BaseDelete);e.NotWhere=t}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.filterOnOccurence=function(t){var n=!1,r=t[this.Column].toLowerCase();switch(this.CompSymbol){case e.Occurence.Any:r.indexOf(this.CompValue)>=0&&(n=!0);break;case e.Occurence.First:0==r.indexOf(this.CompValue)&&(n=!0);break;default:r.lastIndexOf(this.CompValue)==r.length-1&&(n=!0)}return n},n.executeLikeLogic=function(e,t,n){var r=this;this.CompValue=t.toLowerCase(),this.CompSymbol=n,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)},this.CursorOpenRequest.onsuccess=function(e){var t=e.target.result,n=function(){t.delete(),++r.RowAffected};t&&(!r.CheckFlag&&r.filterOnOccurence(t.value)?n():r.filterOnOccurence(t.value)&&r.checkForWhereConditionMatch(t.value)&&n(),t.continue())}},n}return __extends(n,t),n}(t.NotWhere);t.Like=n}(t.Delete||(t.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeRequest=function(e,t,n){var r,o=this;t=n?t[n]:t,(r=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,n))).onsuccess=function(e){var t=e.target.result,n=function(){t.delete(),++o.RowAffected};t&&(o.CheckFlag?o.checkForWhereConditionMatch(t.value)&&n():n(),t.continue())},r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)}},n.executeWhereLogic=function(){for(var t in this.Query.Where){if(!this.ErrorOccured)if(this.ObjectStore.indexNames.contains(t)){var n=this.Query.Where[t];if("string"==typeof n)this.executeRequest(t,n);else if(this.CheckFlag=Object.keys(n).length>1||Object.keys(this.Query.Where).length>1,n.Like){var r=n.Like.split("%");r[1]?r.length>2?this.executeLikeLogic(t,r[1],e.Occurence.Any):this.executeLikeLogic(t,r[1],e.Occurence.Last):this.executeLikeLogic(t,r[0],e.Occurence.First)}else if(n.In)for(var o=0;o<n.In.length;o++)this.executeRequest(t,n.In[o]);else n["-"]?this.executeRequest(t,n,"-"):n[">"]?this.executeRequest(t,n,">"):n["<"]?this.executeRequest(t,n,"<"):n[">="]?this.executeRequest(t,n,">="):n["<="]?this.executeRequest(t,n,"<="):this.executeRequest(t,n)}else this.ErrorOccured=!0,this.Error=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:t}),e.throwError(this.Error);break}},n}return __extends(n,t),n}(t.Like);t.Where=n}(t.Delete||(t.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){!function(e){!function(t){var n=function(t){function n(n,r,o){var s=t.call(this)||this;s.onTransactionCompleted=function(){null!=this.OnSuccess&&this.OnSuccess(this.RowAffected)};try{var u=s;s.Query=n,s.OnSuccess=r,s.OnError=o,s.Transaction=e.DbConnection.transaction([n.From],"readwrite"),s.ObjectStore=s.Transaction.objectStore(n.From),s.Transaction.oncomplete=function(){u.onTransactionCompleted()},s.Transaction.onerror=function(e){u.onErrorOccured(e)},void 0==n.Where?s.executeWhereUndefinedLogic():s.executeWhereLogic()}catch(e){s.onExceptionOccured(e,{TableName:n.From})}return s}return __extends(n,t),n}(t.Where);t.Instance=n}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));var JsStore;!function(e){var t;!function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(t=e.WebWorkerStatus||(e.WebWorkerStatus={})),e.WorkerStatus=t.NotStarted;var n=function(){function n(){this.RequestQueue=[],this.IsCodeExecuting=!1,this.prcoessExecutionOfCode=function(n){this.RequestQueue.push(n),e.EnableLog&&console.log("request pushed:"+n.Name),1==this.RequestQueue.length&&e.WorkerStatus!=t.NotStarted&&this.executeCode()},this.executeCode=function(){if(!this.IsCodeExecuting&&this.RequestQueue.length>0){e.EnableLog&&console.log("request executing : "+this.RequestQueue[0].Name),this.IsCodeExecuting=!0;var n={Name:this.RequestQueue[0].Name,Query:this.RequestQueue[0].Query};e.WorkerStatus==t.Registered?this.executeCodeUsingWorker(n):this.executeCodeDirect(n)}},this.executeCodeDirect=function(t){var n=this;new e.Business.Main(function(e){n.processFinishedRequest(e)}).checkConnectionAndExecuteLogic(t)},this.executeCodeUsingWorker=function(t){e.WorkerInstance.postMessage(t)},this.processFinishedRequest=function(t){var n=this.RequestQueue.shift();this.IsCodeExecuting=!1,n&&(e.EnableLog&&console.log("request finished : "+n.Name),t.ErrorOccured?n.OnError&&n.OnError(t.ErrorDetails):n.OnSuccess&&(null!=t.ReturnedValue?n.OnSuccess(t.ReturnedValue):n.OnSuccess()),this.executeCode())},this.onWorkerFailed=function(){console.warn("JsStore is not runing in web worker"),e.WorkerStatus=t.Failed,this.executeCode()},this.createWorker=function(){var n=this;try{if(Worker){var r=this.getScriptUrl();r&&r.length>0?(e.WorkerInstance=new Worker(r),e.WorkerInstance.onmessage=function(e){n.onMessageFromWorker(e)},setTimeout(function(){e.WorkerStatus!=t.Failed&&(e.WorkerStatus=t.Registered),n.executeCode()},100)):n.onWorkerFailed()}else n.onWorkerFailed()}catch(e){n.onWorkerFailed()}},this.onMessageFromWorker=function(e){var t=this;if("string"==typeof e.data)switch(e.data.split(":")[1]){case"WorkerFailed":t.onWorkerFailed()}else this.processFinishedRequest(e.data)}}return n.prototype.getScriptUrl=function(e){for(var t="",n=e?e.toLowerCase():"jsstore",r=document.getElementsByTagName("script"),o=r.length-1,s="";o>=0;o--)if(s=r[o].src,(s=s.substring(s.lastIndexOf("/")+1).toLowerCase()).length>0&&s.indexOf(n)>=0)return t=r[o].src;return t},n}();e.CodeExecutionHelper=n}(JsStore||(JsStore={}));var Model=JsStore.Model,DataBase=Model.DataBase,Column=Model.Column,Table=Model.Table,JsStore;!function(e){var t=function(t){function n(n){var r=t.call(this)||this;return e.WorkerStatus==e.WebWorkerStatus.NotStarted?(e.Utils.setDbType(),r.createWorker()):(e.WorkerInstance.terminate(),r.createWorker()),null!=n&&r.prcoessExecutionOfCode({Name:"open_db",Query:n}),r}return __extends(n,t),n.prototype.createDb=function(e,t,n){return void 0===n&&(n=null),this.prcoessExecutionOfCode({Name:"create_db",OnSuccess:t,OnError:n,Query:e}),this},n.prototype.dropDb=function(e,t){return void 0===t&&(t=null),this.prcoessExecutionOfCode({Name:"drop_db",OnSuccess:e,OnError:t}),this},n.prototype.select=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=e.OnSuccess?e.OnSuccess:t,o=e.OnError?e.OnError:n;return e.OnSuccess=null,e.OnError=null,this.prcoessExecutionOfCode({Name:"select",Query:e,OnSuccess:r,OnError:o}),this},n.prototype.count=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=e.OnSuccess?e.OnSuccess:t,o=e.OnError?e.OnError:n;return e.OnSuccess=null,e.OnError=null,this.prcoessExecutionOfCode({Name:"count",Query:e,OnSuccess:r,OnError:o}),this},n.prototype.insert=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=e.OnSuccess?e.OnSuccess:t,o=e.OnError?e.OnError:n;return e.OnSuccess=null,e.OnError=null,this.prcoessExecutionOfCode({Name:"insert",Query:e,OnSuccess:r,OnError:o}),this},n.prototype.update=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=e.OnSuccess?e.OnSuccess:t,o=e.OnError?e.OnError:n;return e.OnSuccess=null,e.OnError=null,this.prcoessExecutionOfCode({Name:"update",Query:e,OnSuccess:r,OnError:o}),this},n.prototype.delete=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=e.OnSuccess?e.OnSuccess:t,o=e.OnError?e.OnError:n;return e.OnSuccess=null,e.OnError=null,this.prcoessExecutionOfCode({Name:"delete",Query:e,OnSuccess:r,OnError:o}),this},n.prototype.clear=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=null),this.prcoessExecutionOfCode({Name:"clear",Query:e,OnSuccess:t,OnError:onerror}),this},n}(e.CodeExecutionHelper);e.Instance=t}(JsStore||(JsStore={})),self.alert,self.onmessage=function(e){JsStore.EnableLog&&console.log("Request executing from WebWorker, request name:"+e.data.Name);var t=e.data;(new JsStore.Business.Main).checkConnectionAndExecuteLogic(t)};var KeyStore;!function(e){var t=function(){function e(){}return e.setDbType=function(){if(self.indexedDB=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,indexedDB)self.IDBTransaction=self.IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange;else{if(self.alert)throw"Your browser doesnot support IndexedDb";console.log("worked failed"),self.postMessage("message:WorkerFailed")}},e}();e.Utils=t}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_connected"}(e.ConnectionStatus||(e.ConnectionStatus={})),e.RequestQueue=[],e.TableName="LocalStore",e.IsCodeExecuting=!1}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.prcoessExecutionOfCode=function(t){e.RequestQueue.push(t),1==e.RequestQueue.length&&e.executeCode()},e.executeCode=function(){if(!e.IsCodeExecuting&&e.RequestQueue.length>0){e.IsCodeExecuting=!0;var t={Name:e.RequestQueue[0].Name,Query:e.RequestQueue[0].Query};e.executeCodeDirect(t)}},e.executeCodeDirect=function(t){var n=this;new e.Business.Main(function(e){n.processFinishedRequest(e)}).checkConnectionAndExecuteLogic(t)},e.processFinishedRequest=function(t){var n=e.RequestQueue.shift();e.IsCodeExecuting=!1,t.ErrorOccured?n.OnError?n.OnError(t.ErrorDetails):console.log(t.ErrorDetails):n.OnSuccess&&(null!=t.ReturnedValue?n.OnSuccess(t.ReturnedValue):n.OnSuccess()),this.executeCode()}}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(){return function(){this.Results=null,this.ErrorOccured=!1,this.ErrorCount=0,this.onErrorOccured=function(e){1==++this.ErrorCount&&null!=this.OnError&&this.OnError(e.target.error),console.error(e)}}}();e.Base=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this;s.get=function(){var e=this;for(var t in this.Query.Where){!function(t,n){var r=e.ObjectStore.index(t).openCursor(IDBKeyRange.only(n));r.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)},r.onsuccess=function(t){var n=t.target.result;n&&(e.Results=n.value.Value)}}(t,this.Query.Where[t]);break}};var u=s;return s.Query=n,s.OnError=o,s.Transaction=e.DbConnection.transaction([n.From],"readonly"),s.ObjectStore=s.Transaction.objectStore(n.From),s.Transaction.oncomplete=function(e){null!=r&&r(u.Results)},s.get(),s}return __extends(n,t),n}(e.Base);e.Get=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this;s.setData=function(e){var t=this,n=function(){t.ObjectStore.add(e).onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)}};!function(){var r=t.ObjectStore.index("Key").openCursor(IDBKeyRange.only(e.Key));r.onsuccess=function(t){var r=t.target.result;r?(r.value.Value=e.Value,r.update(r.value)):n()},r.onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)}}()};try{s.OnError=o,s.Transaction=e.DbConnection.transaction([n.TableName],"readwrite"),s.ObjectStore=s.Transaction.objectStore(n.TableName),s.Transaction.oncomplete=function(e){null!=r&&r()},s.setData(n.Set)}catch(e){console.error(e)}return s}return __extends(n,t),n}(e.Base);e.Set=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this;s.RowAffected=0,s.remove=function(){var e=this;for(var t in this.Query.Where){e.ErrorOccured||function(t,n){var r=e.ObjectStore.index(t).openCursor(IDBKeyRange.only(n));r.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)},r.onsuccess=function(t){var n=t.target.result;n&&(n.delete(),++e.RowAffected,n.continue())}}(t,e.Query.Where[t]);break}};var u=s;return s.Query=n,s.OnError=o,s.Transaction=e.DbConnection.transaction([n.From],"readwrite"),s.ObjectStore=s.Transaction.objectStore(n.From),s.Transaction.oncomplete=function(){null!=r&&r(u.RowAffected)},s.Transaction.onerror=function(e){u.onErrorOccured(e)},s.remove(),s}return __extends(n,t),n}(e.Base);e.Remove=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(t){var n=function(){return function(n,r,o,s){var u=self.indexedDB.open(n,1);u.onerror=function(e){null!=s&&s(e.target.error)},u.onsuccess=function(n){t.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=u.result,t.DbConnection.onclose=function(){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection Closed"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(e){t.Status.LastError="Error occured in connection :"+e.target.result},t.DbConnection.onabort=function(n){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection aborted"},null!=o&&o()},u.onupgradeneeded=function(e){e.target.result.createObjectStore(r,{keyPath:"Key"}).createIndex("Key","Key",{unique:!0})}}}();t.InitDb=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){!function(t){t.Status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""};var n=function(){return function(n){void 0===n&&(n=null),this.checkConnectionAndExecuteLogic=function(n){if("create_db"==n.Name||"open_db"==n.Name)this.executeLogic(n);else if(t.Status.ConStatus==e.ConnectionStatus.Connected)this.executeLogic(n);else if(t.Status.ConStatus==e.ConnectionStatus.NotStarted)r=this,setTimeout(function(){r.checkConnectionAndExecuteLogic(n)},50);else if(t.Status.ConStatus==e.ConnectionStatus.Closed){var r=this;this.createDb(e.TableName),setTimeout(function(){r.checkConnectionAndExecuteLogic(n)},50)}},this.returnResult=function(e){this.OnSuccess&&this.OnSuccess(e)},this.executeLogic=function(e){var t=this,n=function(e){t.returnResult({ReturnedValue:e})},r=function(e){t.returnResult({ErrorOccured:!0,ErrorDetails:e})};switch(e.Name){case"get":this.get(e.Query,n,r);break;case"set":this.set(e.Query,n,r);break;case"remove":this.remove(e.Query,n,r);break;case"create_db":this.createDb(e.Query,n,r)}},this.set=function(e,n,r){new t.Set(e,n,r)},this.remove=function(e,n,r){new t.Remove(e,n,r)},this.get=function(e,n,r){new t.Get(e,n,r)},this.createDb=function(e,n,r){new t.InitDb("KeyStore",e,n,r)},this.OnSuccess=n}}();t.Main=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.init=function(){e.Utils.setDbType(),indexedDB&&e.prcoessExecutionOfCode({Name:"create_db",Query:e.TableName})},e.get=function(t,n,r){void 0===r&&(r=null);var o={From:this.TableName,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"get",Query:o,OnSuccess:n,OnError:r}),this},e.set=function(t,n,r,o){void 0===r&&(r=null),void 0===o&&(o=null);var s={TableName:this.TableName,Set:{Key:t,Value:n}};return e.prcoessExecutionOfCode({Name:"set",Query:s,OnSuccess:r,OnError:o}),this},e.remove=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var o={From:this.TableName,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"remove",Query:o,OnSuccess:n,OnError:r}),this}}(KeyStore||(KeyStore={})),KeyStore.init();